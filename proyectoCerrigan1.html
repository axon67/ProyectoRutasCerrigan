<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buscador con Tabla</title>
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin: 24px; }
    .wrap { max-width: 1200px; margin: 0 auto; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    input[type="text"] { padding: 10px 12px; border-radius: 8px; border: 1px solid #cbd5e1; outline: none; }
    input[type="text"]:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.15); }
    button { padding: 6px 8px; border: 0; border-radius: 8px; cursor: pointer; margin: 1px }
    .btn { background: #3b82f6; color: white; }
    .btn-secondary { background: #0ea5e9; color: white; }
    .muted { color: #6b7280; }
   table {
  width: 100%;
  border-collapse: collapse;
  text-align: center; /* Centra el contenido por defecto */
}

th, td {
  text-align: center; /* Centra texto en todas las celdas */
  vertical-align: middle; /* Centra verticalmente */
  padding: 8px;
}
    th { background: #f8fafc; }
    .highlight { background: #fff7cc; }
    .empty { padding: 16px; text-align: center; color: #6b7280; }
    a { color: #2563eb; text-decoration: none; }
    a:hover { text-decoration: underline; }

    /* Modal Imagen */
    #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
    #modalContent { position:relative; background:#fff; padding:16px; border-radius:12px; 
      max-width:90%; max-height:90%; }
    #modalImg { max-width:100%; max-height:80vh; display:block; margin:auto; border-radius:8px; }
    #cerrarModal {  position:absolute; top:8px; right:12px; cursor:pointer; font-size:22px; font-weight:bold; color:#555; background:none; border:none; }

    /* Modal Direcci√≥n */
    #modalDireccion { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
    #modalDireccionContent { background:#fff; padding:16px; border-radius:12px; max-width:500px; width:90%; position:relative; }
    #cerrarModalDireccion { position:absolute; top:8px; right:12px; cursor:pointer; font-size:20px; }

    #detalleDireccion {
      margin-top: 12px;
      font-size: 16px;
      color: #374151;
      white-space: pre-line; /* üëà esto hace que funcione el Enter */
    }

  </style>
</head>
<body>
  <div class="wrap">
    <h1>Buscador</h1>

    <!-- üîç BUSCADOR -->
    <div class="card" style="margin-bottom:16px">
      <div class="row">
        <input id="buscador" type="text" placeholder="Escribe para buscar..." autofocus />
        <button id="btnLimpiar" class="btn-secondary" title="Limpiar">Limpiar</button>
        <button id="btnToggleForm" class="btn">‚ûï Mostrar/Ocultar Formulario</button>
      </div>
      <p class="muted" style="margin:8px 0 0">Mostrando resultados para: <strong id="queryDisplay">‚Äî</strong></p>
    </div>

     <!-- ‚ûï FORMULARIO -->
<div id="formularioCard" class="card" style="margin-bottom:16px; display:none;">
  <h2 style="margin-top:0">Agregar / Editar datos</h2>
  <div class="row">
    <input id="nuevoEmpresa" type="text" placeholder="Empresa / Lugar" />
    <input id="nuevaDireccion" type="text" placeholder="Direcci√≥n corta" />
    <textarea id="nuevoDetalleDireccion" placeholder="Detalle de la direcci√≥n" rows="3" style="padding:10px 12px; border-radius:8px; border:1px solid #cbd5e1; width:100%; resize:vertical;"></textarea>
    <input id="nuevoDistrito" type="text" placeholder="Distrito" />
    <input id="nuevoTelefono" type="text" placeholder="Tel√©fono" />
    <input id="nuevaCategoria" type="text" placeholder="Categor√≠a" />
    <input id="nuevoLink" type="text" placeholder="Link de Google Maps" />
    <input id="nuevaImagen" type="text" placeholder="URL de la imagen" />
    <input id="nuevoHorario" type="text" placeholder="Horario de atenci√≥n" />
    <button id="btnAgregar" class="btn">Agregar</button>
    <button id="btnBorrar" class="btn-secondary" title="Borrar todo">üóëÔ∏è Borrar todo</button>
  </div>
</div>


    <!-- üìã RESULTADOS -->
    <div class="card">
      <div class="row" style="justify-content: space-between; margin-bottom: 8px;">
        <h2 style="margin:0">Resultados</h2>
        <span class="muted" id="conteo">0 items</span>
      </div>
      <div style="overflow:auto">
        <table id="tabla">
          <thead>
            <tr>
              <th>ID</th>
              <th>Empresa</th>
              <th>Distrito</th>
              <th>Direcci√≥n</th>
              <th>Ubicaci√≥n</th>
              <th>Categor√≠a</th>
              <th>Horario</th>
              <th>Tel√©fono</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div id="vacio" class="empty" style="display:none">Sin resultados</div>
    </div>
  </div>

  <!-- Modal Imagen -->
  <div id="modal">
    <div id="modalContent">
      <span id="cerrarModal">‚úñ</span>
      <img id="modalImg" src="" alt="Vista">
    </div>
  </div>

  <!-- Modal Direcci√≥n -->
  <div id="modalDireccion">
    <div id="modalDireccionContent">
      <span id="cerrarModalDireccion">‚úñ</span>
      <h3>Detalle de Direcci√≥n</h3>
      <p id="detalleDireccion" style="margin-top:12px; font-size:16px; color:#374151;"></p>
    </div>
  </div>

  <script>
  const STORAGE_KEY = "misDatos";

  const BASE_DATOS = [
    { id: 1, empresa: "CBC peruana", direccion: "Huachipa", detalleDireccion: "Los Laureles 127, Lurigancho-Chosica 15457", distrito: "Este Lurigancho", telefono: "990297533", categoria: "Entrega", link: "https://maps.app.goo.gl/YBjWY1vPtzsbBUP76", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/cbcPeruana.png?raw=true", horario: "3pm" },
    { id: 2, empresa: "Resemin S.A", direccion: "Urb Inds Sta Rosa", detalleDireccion: "Luis Galvani 392, Lima 15022", distrito: "Este Ate", telefono: "987654321", categoria: "Entrega", link: "https://maps.app.goo.gl/KRvQv7YVbn7MX8mLA", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/reseminAte.png?raw=true", horario: "Lun-Sab 9am-5pm" },
    { id: 3, empresa: "Caliza inka", direccion: "Huachipa", detalleDireccion: "Sub Lote, Av. Cajamarquilla 2C, Lurigancho-Chosica", distrito: "Este Lurigancho", telefono: "-", categoria: "Empresa", link: "https://maps.app.goo.gl/XX6wbq553ud4aNWc6", imagen: "-", horario: "3pm" },
    { id: 4, empresa: "Resemin Priale", direccion: "Huachipa", detalleDireccion: "Av. Huachipa 215, Lima 15457", distrito: "Este Lurigancho", telefono: "-", categoria: "Entrega", link: "https://maps.app.goo.gl/HV4WRc8MiC3iArb3A", imagen: "-", horario: "3pm" },
    { id: 5, empresa: "Depositos Qu√≠micos", direccion: "-", detalleDireccion: "-", distrito: "Callao", telefono: "-", categoria: "Entrega", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/ProindustriaEyMCompras.jpg?raw=true", horario: "-" },
    { id: 6, empresa: "Sonepar", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 7, empresa: "Cojusol", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 8, empresa: "Jenner", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 9, empresa: "Goalsa", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 10, empresa: "Grupo Carlitos", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 11, empresa: "TuboLuz", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 12, empresa: "Paz Mena", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 13, empresa: "Proindustrias EyM", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 14, empresa: "Jordan", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 15, empresa: "Terraplastic paruro", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 16, empresa: "Terraplastic Sociedad Anonima", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 17, empresa: "Terraplastic principal", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 18, empresa: "SyH Representaciones", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 19, empresa: "Fiorella Representaciones", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 20, empresa: "Guantes y Guantes", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 21, empresa: "Iluminaciones Milenium", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 22, empresa: "Bendezu", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 22, empresa: "Prosinfer", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
    { id: 23, empresa: "Forusa", direccion: "Malvinas", detalleDireccion: "-", distrito: "-", telefono: "-", categoria: "Entrega", link: "-", imagen: "", horario: "-" },
  ];

  let datos = [...BASE_DATOS, ...(JSON.parse(localStorage.getItem(STORAGE_KEY)) || [])];

  function guardarDatos() {
    const extras = datos.filter(d => d.id > BASE_DATOS.length);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(extras));
  }

  let filtro = "";
  let editandoId = null;
  const el = (id) => document.getElementById(id);

  function normalizarTexto(t) {
    return (t ?? "").toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
  }

  function coincideRegistro(reg, needle) {
    if (!needle) return true;
    const n = normalizarTexto(needle);
    return [reg.id, reg.empresa, reg.direccion, reg.detalleDireccion, reg.distrito, reg.telefono, reg.categoria, reg.horario]
      .map(v => normalizarTexto(v))
      .some(v => v.includes(n));
  }

  function resaltarCoincidencias(texto, needle) {
    if (!needle) return String(texto);
    const t = String(texto);
    const n = normalizarTexto(needle);
    const base = normalizarTexto(t);
    let res = "", i = 0;
    while (i < t.length) {
      if (base.slice(i).startsWith(n)) {
        res += `<span class="highlight">${t.slice(i, i + needle.length)}</span>`;
        i += needle.length;
      } else { res += t[i]; i++; }
    }
    return res;
  }

  function render() {
    const cuerpo = el("tbody"), vacio = el("vacio"), conteo = el("conteo"), queryDisplay = el("queryDisplay");
    const filtrados = datos.filter(d => coincideRegistro(d, filtro));
    conteo.textContent = `${filtrados.length} ${filtrados.length === 1 ? "item" : "items"}`;
    queryDisplay.textContent = filtro ? `"${filtro}"` : "‚Äî";
    cuerpo.innerHTML = "";
    if (filtrados.length === 0) { vacio.style.display = "block"; return; } else { vacio.style.display = "none"; }

    const frag = document.createDocumentFragment();
    filtrados.forEach((reg) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${reg.id}</td>
        <td><a href="#" class="empresaLink" data-img="${reg.imagen}">${resaltarCoincidencias(reg.empresa, filtro)}</a></td>
        <td>${resaltarCoincidencias(reg.distrito, filtro)}</td>
        <td><a href="#" class="direccionLink" data-dir="${reg.detalleDireccion}">${resaltarCoincidencias(reg.direccion, filtro)}</a></td>
        <td><a href="${reg.link}" target="_blank">Ver en Maps</a></td>
        <td>${resaltarCoincidencias(reg.categoria, filtro)}</td>
        <td>${resaltarCoincidencias(reg.horario ?? "‚Äî", filtro)}</td>
        <td>${resaltarCoincidencias(reg.telefono, filtro)}</td>
        <td>
          <button class="btn-secondary btnEditar" data-id="${reg.id}">‚úèÔ∏è</button>
          <button class="btn btnEliminar" data-id="${reg.id}">üóëÔ∏è</button>
        </td>
      `;
      frag.appendChild(tr);
    });
    cuerpo.appendChild(frag);
  }

  el("buscador").addEventListener("input", e => { filtro = e.target.value.trim(); render(); });
  el("btnLimpiar").addEventListener("click", () => { filtro = ""; el("buscador").value = ""; render(); el("buscador").focus(); });
  el("btnToggleForm").addEventListener("click", () => {
    const formCard = el("formularioCard");
    formCard.style.display = formCard.style.display === "none" ? "block" : "none";
  });

  el("btnAgregar").addEventListener("click", () => {
    const empresa = el("nuevoEmpresa").value.trim();
    const direccion = el("nuevaDireccion").value.trim();
    const detalleDireccion = el("nuevoDetalleDireccion").value.trim();
    const distrito = el("nuevoDistrito").value.trim();
    const telefono = el("nuevoTelefono").value.trim();
    const categoria = el("nuevaCategoria").value.trim();
    const link = el("nuevoLink").value.trim();
    const imagen = el("nuevaImagen").value.trim();
    const horario = el("nuevoHorario").value.trim();

    if (!empresa || !direccion || !detalleDireccion || !distrito || !telefono || !categoria || !link || !imagen || !horario) {
      alert("Completa todos los campos."); return;
    }

    if (editandoId) {
      const idx = datos.findIndex(d => d.id === editandoId);
      datos[idx] = { id: editandoId, empresa, direccion, detalleDireccion, distrito, telefono, categoria, link, imagen, horario };
      editandoId = null;
    } else {
      const nextId = (datos.at(-1)?.id ?? 0) + 1;
      datos.push({ id: nextId, empresa, direccion, detalleDireccion, distrito, telefono, categoria, link, imagen, horario });
    }

    guardarDatos();
    el("nuevoEmpresa").value =
    el("nuevaDireccion").value =
    el("nuevoDetalleDireccion").value =
    el("nuevoDistrito").value =
    el("nuevoTelefono").value =
    el("nuevaCategoria").value =
    el("nuevoLink").value =
    el("nuevaImagen").value =
    el("nuevoHorario").value = "";
    render();
  });

  document.addEventListener("click", e => {
    if (e.target.classList.contains("btnEditar")) {
      const id = parseInt(e.target.dataset.id);
      const registro = datos.find(d => d.id === id);
      if (!registro) return;
      el("nuevoEmpresa").value = registro.empresa;
      el("nuevaDireccion").value = registro.direccion;
      el("nuevoDetalleDireccion").value = registro.detalleDireccion;
      el("nuevoDistrito").value = registro.distrito;
      el("nuevoTelefono").value = registro.telefono;
      el("nuevaCategoria").value = registro.categoria;
      el("nuevoLink").value = registro.link;
      el("nuevaImagen").value = registro.imagen;
      el("nuevoHorario").value = registro.horario ?? "";
      editandoId = id;
      el("formularioCard").style.display = "block";
    }
  });

  document.addEventListener("click", e => {
    if (e.target.classList.contains("btnEliminar")) {
      const id = parseInt(e.target.dataset.id);
      if (id <= BASE_DATOS.length) {
        alert("No puedes eliminar un dato base.");
        return;
      }
      if (confirm("¬øSeguro que quieres eliminar este registro?")) {
        datos = datos.filter(d => d.id !== id);
        guardarDatos();
        render();
      }
    }
  });

  el("btnBorrar").addEventListener("click", () => {
    if (confirm("¬øSeguro que quieres borrar todos los registros agregados?")) {
      datos = [...BASE_DATOS];
      localStorage.removeItem(STORAGE_KEY);
      render();
    }
  });

  document.addEventListener("click", e => {
    if (e.target.classList.contains("empresaLink")) {
      e.preventDefault();
      const img = e.target.dataset.img;
      el("modalImg").src = img;
      el("modal").style.display = "flex";
    }
  });
  el("cerrarModal").addEventListener("click", () => { el("modal").style.display = "none"; });

  document.addEventListener("click", e => {
    if (e.target.classList.contains("direccionLink")) {
      e.preventDefault();
      const detalle = e.target.dataset.dir;
      el("detalleDireccion").textContent = detalle;
      el("modalDireccion").style.display = "flex";
    }
  });
  el("cerrarModalDireccion").addEventListener("click", () => { el("modalDireccion").style.display = "none"; });

  render();
</script>

</body>
</html>
