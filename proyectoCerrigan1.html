<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Buscador con Tabla</title>
  <style>
    :root { font-family: system-ui, Arial, sans-serif; }
    body { margin: 24px; }
    .wrap { max-width: 1200px; margin: 0 auto; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; box-shadow: 0 1px 3px rgba(0,0,0,.06); }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    input[type="text"], textarea { padding: 10px 12px; border-radius: 8px; border: 1px solid #cbd5e1; outline: none; }
    input[type="text"]:focus, textarea:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,.12); }
    button { padding: 6px 8px; border: 0; border-radius: 8px; cursor: pointer; margin: 1px }
    .btn { background: #3b82f6; color: white; }
    .btn-secondary { background: #0ea5e9; color: white; }
    .muted { color: #6b7280; }
    table { width: 100%; border-collapse: collapse; text-align: center; }
    th, td { text-align: center; vertical-align: middle; padding: 8px; }
    th { background: #f8fafc; }
    .highlight { background: #fff7cc; }
    .empty { padding: 16px; text-align: center; color: #6b7280; }
    a { color: #2563eb; text-decoration: none; }
    a:hover { text-decoration: underline; }
    /* Modal Imagen */
    #modal { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
    #modalContent { position:relative; background:#fff; padding:16px; border-radius:12px; 
      max-width:90%; max-height:90%; }
    #modalImg { max-width:100%; max-height:80vh; display:block; margin:auto; border-radius:8px; }
    #cerrarModal {  position:absolute; top:8px; right:12px; cursor:pointer; font-size:22px; font-weight:bold; color:#555; background:none; border:none; }
    /* Modal Direcci√≥n */
    #modalDireccion { display:none; position:fixed; top:0; left:0; width:100%; height:100%;
      background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:1000; }
    #modalDireccionContent { background:#fff; padding:16px; border-radius:12px; max-width:600px; width:92%; position:relative; }
    #cerrarModalDireccion { position:absolute; top:8px; right:12px; cursor:pointer; font-size:20px; background:none; border:none; }
    #detalleDireccion { margin-top: 12px; font-size: 16px; color: #374151; white-space: pre-line; }
    .small-input { width: 180px; }
    textarea { width:100%; resize:vertical; min-height:64px; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Buscador</h1>

    <!-- üîç BUSCADOR -->
    <div class="card" style="margin-bottom:16px">
      <div class="row">
        <input id="buscador" type="text" placeholder="Escribe para buscar..." autofocus />
        <button id="btnLimpiar" class="btn-secondary" title="Limpiar">Limpiar</button>
        <button id="btnToggleForm" class="btn">‚ûï Mostrar/Ocultar Formulario</button>
      </div>
      <p class="muted" style="margin:8px 0 0">Mostrando resultados para: <strong id="queryDisplay">‚Äî</strong></p>
    </div>

    <!-- ‚ûï FORMULARIO -->
    <div id="formularioCard" class="card" style="margin-bottom:16px; display:none;">
      <h2 style="margin-top:0">Agregar / Editar datos</h2>
      <div class="row" style="align-items:flex-start;">
        <input id="nuevoEmpresa" type="text" placeholder="Empresa / Lugar" class="small-input" />
        <input id="nuevaDireccion" type="text" placeholder="Direcci√≥n corta" class="small-input" />
        <input id="nuevoDistrito" type="text" placeholder="Distrito" class="small-input" />
        <input id="nuevoTelefono" type="text" placeholder="Tel√©fono" class="small-input" />
        <input id="nuevaCategoria" type="text" placeholder="Categor√≠a" class="small-input" />
        <input id="nuevoHorario" type="text" placeholder="Horario de atenci√≥n" class="small-input" />
        <input id="nuevoLink" type="text" placeholder="Link de Google Maps" style="flex:1 1 100%;" />
        <input id="nuevaImagen" type="text" placeholder="URL de la imagen" style="flex:1 1 100%;" />
        <textarea id="nuevoDetalleDireccion" placeholder="Detalle de la direcci√≥n (enter funciona)"></textarea>
        <div style="display:flex; gap:8px; align-items:center;">
          <button id="btnAgregar" class="btn">Agregar / Guardar</button>
          <button id="btnBorrar" class="btn-secondary" title="Borrar todo">üóëÔ∏è Borrar todo</button>
        </div>
      </div>
    </div>

    <!-- üìã RESULTADOS -->
    <div class="card">
      <div class="row" style="justify-content: space-between; margin-bottom: 8px;">
        <h2 style="margin:0">Resultados</h2>
        <span class="muted" id="conteo">0 items</span>
      </div>
      <div style="overflow:auto">
        <table id="tabla">
          <thead>
            <tr>
              <th>ID</th>
              <th>Empresa</th>
              <th>Distrito</th>
              <th>Direcci√≥n</th>
              <th>Ubicaci√≥n</th>
              <th>Categor√≠a</th>
              <th>Horario</th>
              <th>Tel√©fono</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
      <div id="vacio" class="empty" style="display:none">Sin resultados</div>
    </div>
  </div>

  <!-- Modal Imagen -->
  <div id="modal">
    <div id="modalContent">
      <button id="cerrarModal">‚úñ</button>
      <img id="modalImg" src="" alt="Vista">
    </div>
  </div>

  <!-- Modal Direcci√≥n -->
  <div id="modalDireccion">
    <div id="modalDireccionContent">
      <button id="cerrarModalDireccion">‚úñ</button>
      <h3>Detalle de Direcci√≥n</h3>
      <p id="detalleDireccion"></p>
    </div>
  </div>

  <script>
  const STORAGE_KEY = "misDatos";

  const BASE_DATOS = [
     { id: 1, empresa: "CBC peruana", direccion: "Huachipa", detalleDireccion: "Los Laureles 127, Lurigancho-Chosica 15457", distrito: "Este Lurigancho", telefono: "990297533", categoria: "Entrega", link: "https://maps.app.goo.gl/YBjWY1vPtzsbBUP76", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/cbcPeruana.png?raw=true", horario: "3pm" },
    { id: 2, empresa: "Resemin S.A", direccion: "Urb Inds Sta Rosa", detalleDireccion: "Luis Galvani 392, Lima 15022", distrito: "Este Ate", telefono: "987654321", categoria: "Entrega", link: "https://maps.app.goo.gl/KRvQv7YVbn7MX8mLA", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/reseminAte.png?raw=true", horario: "Lun-Sab 9am-5pm" },
    { id: 3, empresa: "Caliza inka", direccion: "Huachipa", detalleDireccion: "Sub Lote, Av. Cajamarquilla 2C, Lurigancho-Chosica", distrito: "Este Lurigancho", telefono: "-", categoria: "Empresa", link: "https://maps.app.goo.gl/XX6wbq553ud4aNWc6", imagen: "-", horario: "3pm" },
    { id: 4, empresa: "Resemin Priale", direccion: "Huachipa", detalleDireccion: "Av. Huachipa 215, Lima 15457", distrito: "Este Lurigancho", telefono: "-", categoria: "Entrega", link: "https://maps.app.goo.gl/HV4WRc8MiC3iArb3A", imagen: "-", horario: "3pm" },

  // empresas de compras
  { id: 5, empresa: "SAMPLAST S.A.C.", direccion: "Av. El Bosque 883", detalleDireccion: "Av. El Bosque 883, Urb. Semi R√∫stica", distrito: "Este SJL", telefono: "987303111", categoria: "Compras", link: "-", imagen: "-", horario: "10am‚Äì12pm / 2‚Äì5pm" },
  { id: 6, empresa: "ROATSA", direccion: "Av. Defensores del Morro 222", detalleDireccion: "Av. Defensores del Morro 222", distrito: "Sur Chorrillos", telefono: "965399694", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 8:30‚Äì6pm, S√°b 8:30‚Äì12pm" },
  { id: 7, empresa: "MULTIUTILES.COM", direccion: "Jr. Caman√° 1103", detalleDireccion: "Jr. Caman√° 1103 (Cruce con Uruguay, frente al Ceprevi)", distrito: "Centro Lima", telefono: "998299624", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 9:05‚Äì7:20pm, S√°b 9:30‚Äì6:15pm" },
  { id: 9, empresa: "IMPORT SUMARY E.I.R.L.", direccion: "Jr. Paruro 1132", detalleDireccion: "Jr. Paruro 1132", distrito: "Centro Lima", telefono: "962640043", categoria: "Compras", link: "-", imagen: "-", horario: "9:30am‚Äì7pm" },
  { id: 10, empresa: "PAZ MENA EDGAR H.", direccion: "Av. Argentina 215", detalleDireccion: "Av. Argentina 215, CC Nicolini, Int AR-4 Pasaje 2", distrito: "Centro Lima", telefono: "994223603", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìS√°b 9‚Äì6" },
  { id: 11, empresa: "TECNIEMPAQUETADURAS SR LTDA", direccion: "Av. Alfonso Ugarte 760", detalleDireccion: "Av. Alfonso Ugarte 760 Int. 202", distrito: "Centro Lima", telefono: "989779850", categoria: "Compras", link: "-", imagen: "-", horario: "-" },
  { id: 12, empresa: "CORPORACI√ìN ELECTRO INDUSTRIAL", direccion: "Malvinas", detalleDireccion: "Malvinas", distrito: "Centro Malvinas", telefono: "950499053", categoria: "Compras", link: "-", imagen: "-", horario: "-" },
  { id: 13, empresa: "CIA STALEX S.A.C.", direccion: "Guillermo Dansey 979", detalleDireccion: "Guillermo Dansey 979 Int. E7", distrito: "Centro Malvinas", telefono: "998849258", categoria: "Compras", link: "-", imagen: "-", horario: "-" },
  { id: 14, empresa: "INVERSIONES TUBO LUZ E.I.R.L.", direccion: "Calle Ascope 462", detalleDireccion: "Calle Ascope 462 Int. 16Y1", distrito: "Centro Malvinas", telefono: "994173093", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 9‚Äì5:30, S√°b 9‚Äì1" },
  { id: 15, empresa: "PROSINFER E.I.R.L.", direccion: "C. Jos√© Celend√≥n 1072", detalleDireccion: "C. Jos√© Celend√≥n 1072 (Entre Av. Due√±as y Av. Colonial)", distrito: "Centro Lima", telefono: "918527378", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 9‚Äì6, S√°b 9‚Äì1" },
  { id: 16, empresa: "COROIMPORT S.A.C.", direccion: "Luis Galvani 381", detalleDireccion: "Luis Galvani 381, Urb. Ate 3", distrito: "Este Ate", telefono: "940246764", categoria: "Compras", link: "-", imagen: "-", horario: "12‚Äì12:30 / 2‚Äì4:30" },
  { id: 17, empresa: "CODIFELSA S.A.C.", direccion: "Av. Guillermo Dansey 411", detalleDireccion: "Av. Guillermo Dansey 411, CC Plaza Ferretero, Pasaje B, SS092", distrito: "Centro Malvinas", telefono: "994121136", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 9‚Äì6, S√°b 9‚Äì1" },
  { id: 18, empresa: "IMPORTADORA Y DISTRIBUIDORA DE‚Ä¶", direccion: "Jr. C√°rcamo 506", detalleDireccion: "Jr. C√°rcamo 506", distrito: "Centro Lima", telefono: "936524459", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 8‚Äì6 corrido" },
  { id: 19, empresa: "ILUMINACIONES MILLENIUM S.A.C.", direccion: "Jr. Lampa 1125A", detalleDireccion: "Jr. Lampa 1125A", distrito: "Centro Lima", telefono: "946595601", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìS√°b 9‚Äì7" },
  { id: 20, empresa: "ELECTRONIC MIHABA CORP.", direccion: "Jr. Pascual Oliveros 873", detalleDireccion: "Jr. Pascual Oliveros 873, Urb. Sta. Catalina", distrito: "Centro La Victoria", telefono: "960405732", categoria: "Compras", link: "-", imagen: "-", horario: "Lun‚ÄìVie 9‚Äì6, S√°b 9‚Äì1" },
  { id: 21, empresa: "AGERSA PER√ö E.I.R.L.", direccion: "Av. Abancay 815", detalleDireccion: "Av. Abancay 815 Int. 130", distrito: "Centro Lima", telefono: "918428772", categoria: "Compras", link: "-", imagen: "-", horario: "9:30‚Äì7pm" },
  { id: 22, empresa: "UYUSTOOLS PER√ö SRL", direccion: "Jr. Juan del Mar y Bernedo 1040", detalleDireccion: "Jr. Juan del Mar y Bernedo 1040, Urb. Chacra R√≠os Sur", distrito: "Centro Bre√±a", telefono: "-", categoria: "Compras", link: "-", imagen: "-", horario: "-" },
  { id: 23, empresa: "PROINDUSTRIAS E Y M", direccion: "Av. Guillermo Dansey 417", detalleDireccion: "Av. Guillermo Dansey 417, CC Plaza Ferretero, S√≥tano SS007 Pasaje C (Malvinas)", distrito: "Centro Malvinas", telefono: "970666778", categoria: "Compras", link: "-", imagen: "-", horario: "9am a 6pm / hasta 1pm" },
  { id: 24, empresa: "COREINJ", direccion: "Av. Guillermo Dansey 454", detalleDireccion: "Av. Guillermo Dansey 454, CC Nicolini, Psj 5 Stand BB-9A, Malvinas", distrito: "Centro Malvinas", telefono: "950499053", categoria: "Compras", link: "-", imagen: "-", horario: "9am a 6pm / hasta 1pm" },

  
  { id: 25, empresa: "IMPORTACIONES ROSALUZ", direccion: "Av. Guillermo Dansey 413", detalleDireccion: "Av. Guillermo Dansey 413 (C. Ferretero)", distrito: "Centro Lima", contacto: "Rosaluz Hernandez", telefono: "922337568", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 26, empresa: "ELECTRO ENCHUFE S.A.C.", direccion: "Av. √ìscar R. Benavides 405", detalleDireccion: "Av. √ìscar R. Benavides 405, Lima 15082", distrito: "Centro Lima", contacto: "-", telefono: "972521029", horario: "8am a 6pm", categoria: "Compras", link: "-", imagen: "-" },
  { id: 27, empresa: "V & M SAFETY PERU S.A.C.", direccion: "Jr. Ascope 569", detalleDireccion: "Jir√≥n Ascope 569, Esq. Malvinas", distrito: "Centro Lima", contacto: "Guadalupe", telefono: "963963015", horario: "L-V 9am a 6pm (No s√°bados)", categoria: "Compras", link: "-", imagen: "-" },
  
  { id: 28, empresa: "WELDER POWER EIRL", direccion: "Av. Oscar R. Benavides 102", detalleDireccion: "Av. Oscar R. Benavides 102, Plaza 2 de Mayo (Ref: Grifo Repsol)", distrito: "Centro Lima", contacto: "-", telefono: "-", horario: "Hasta las 4PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 29, empresa: "DISTRIBUIDORA CLEAN TWIST", direccion: "Paseo de la Rep√∫blica 788", detalleDireccion: "Paseo de la Rep√∫blica 788 Urbanizaci√≥n, La Victoria", distrito: "Centro La Victoria", contacto: "-", telefono: "992906361", horario: "L‚ÄìV 9AM‚Äì6PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 30, empresa: "TERRA PLASTIC S.A.", direccion: "Jr. Andahuaylas 1009", detalleDireccion: "Jr. Andahuaylas 1009", distrito: "Centro Lima", contacto: "-", telefono: "994482151", horario: "9AM‚Äì7PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/En%20terraplastic%20SACCompras.jpg?raw=true" },
  { id: 31, empresa: "AGROMARKET.PE", direccion: "Calle Alcanfores 1245", detalleDireccion: "Calle Alcanfores 1245 (Larcomar)", distrito: "Sur Miraflores", contacto: "Bruno Cilloniz", telefono: "970125799", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 32, empresa: "GRUPO CARLITOS S.A.", direccion: "Jr. Huarochir√≠ 649‚Äì653", detalleDireccion: "Jr. Huarochir√≠ 649‚Äì653, Malvinas", distrito: "Centro Lima", contacto: "-", telefono: "994035623", horario: "L‚ÄìV 8AM‚Äì6PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 33, empresa: "GOALSA CENTER S.A.C.", direccion: "Av. Guillermo Dansey 417", detalleDireccion: "Av. Guillermo Dansey 417, 3er piso Tienda 3022‚Äì3023, C.C. Plaza Ferretero ‚Äì Malvinas", distrito: "Centro Lima", contacto: "-", telefono: "999329541 / 969472462", horario: "L‚ÄìV 9AM‚Äì6PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 34, empresa: "ARDICORP SAC", direccion: "Sta. Mar√≠a 230", detalleDireccion: "La Aurora, Sta. Mar√≠a 230, Ate 15022", distrito: "Este Ate", contacto: "Richard", telefono: "-", horario: "L‚ÄìV 9AM‚Äì5PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 35, empresa: "IMPORTACIONES CODIZA S.A.", direccion: "Malvinas C√°rcamo", detalleDireccion: "Malvinas C√°rcamo", distrito: "Centro Lima", contacto: "-", telefono: "994271457", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 36, empresa: "FERRETER√çA INDUSTRIAL JORDAN", direccion: "Malvinas", detalleDireccion: "Malvinas", distrito: "Centro Lima", contacto: "Sr. Blanco", telefono: "998227989", horario: "L‚ÄìV 9AM‚Äì5:30PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 37, empresa: "CARDEPACK", direccion: "Villa El Salvador", detalleDireccion: "Villa El Salvador", distrito: "Sur Villa El Salvador", contacto: "Enrique S√°nchez", telefono: "-", horario: "Hasta las 5PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 38, empresa: "YOHERSA", direccion: "Av. El Sol 208", detalleDireccion: "Av. El Sol 208, Villa El Salvador 15816", distrito: "Sur Villa El Salvador", contacto: "-", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 39, empresa: "DAYR", direccion: "Jr. Las Getias Mz. A Lote 42", detalleDireccion: "Jr. Las Getias Mz. A Lote 42, Urb. Las Flores 78", distrito: "Este SJL", contacto: "WA", telefono: "905471483", horario: "7AM‚Äì5PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 40, empresa: "PLESA", direccion: "C. Jos√© D√≠az 426", detalleDireccion: "C. Jos√© D√≠az 426, Lima 15046", distrito: "Centro Lima", contacto: "-", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 41, empresa: "AMERICAS", direccion: "Av. Jose Galvez 1015", detalleDireccion: "Av. Jose Galvez Nro. 1015", distrito: "Centro La Victoria", contacto: "-", telefono: "946458176", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 42, empresa: "FABRICACIONES Y EMPAQUETADURAS REY", direccion: "Psje. San Benito de Palermo 164", detalleDireccion: "Psje. San Benito de Palermo 164, Coop. Ni√±o Jes√∫s (Alt. cdra. 5 Av. C√°rcamo c/ Av. Colonial)", distrito: "Centro Lima", contacto: "Valent√≠n G.", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 43, empresa: "PIZARRAS DANNY E.I.R.L", direccion: "Jr. Ucayali 779 A", detalleDireccion: "Jr. Ucayali 779 A, Lima Cercado", distrito: "Centro Lima", contacto: "Sr. Roberto", telefono: "946054176", horario: "L-S 10AM ‚Äì 7PM (corrido)", categoria: "Compras", link: "-", imagen: "-" },
  { id: 44, empresa: "HALLEY PERFORMANCE", direccion: "Bre√±a", detalleDireccion: "Bre√±a", distrito: "Centro Bre√±a", contacto: "-", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 45, empresa: "PROMELSA", direccion: "Av. Guillermo Dansey 1094", detalleDireccion: "Av. Guillermo Dansey 1094, Cercado de Lima", distrito: "Centro Lima", contacto: "WA Ventas", telefono: "994591915", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 46, empresa: "RM SMART S.A.C.", direccion: "Barrios Altos", detalleDireccion: "Barrios Altos, Tienda 363, frente a la juguer√≠a, rampa subiendo", distrito: "Centro Lima", contacto: "-", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 47, empresa: "TECNIFAJAS S.A.", direccion: "Av. Argentina 3006", detalleDireccion: "Av. Argentina 3006, Lima", distrito: "Centro Lima", contacto: "Mart√≠n C.", telefono: "998145590", horario: "L-V 8:30AM‚Äì5:30PM / S 8:30AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 48, empresa: "INDUSTRIAL COMERCIAL SANTA ADE", direccion: "Av. Colonial 2463", detalleDireccion: "Av. Colonial 2463, Urb., Lima 15081", distrito: "Centro Cercado Lima", contacto: "Uber Salazar", telefono: "989595313", horario: "L-V 8AM‚Äì5:45PM (corr.)", categoria: "Compras", link: "-", imagen: "-" },
  { id: 49, empresa: "WEST VISION", direccion: "Jr. Cuzco 440, Int. 288", detalleDireccion: "Jr. Cuzco 440, Int. 288, Lima", distrito: "Centro Lima", contacto: "Eva S.", telefono: "997307059", horario: "L-V 10:30AM‚Äì6PM / S 10:30AM‚Äì2PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 50, empresa: "DASMITEC PER√ö", direccion: "Av. Garcilaso de la Vega 1358, C.C. Plazatec Int. 344", detalleDireccion: "Av. Garcilaso de la Vega 1358, C.C. Plazatec Int. 344, Lima", distrito: "Centro Lima", contacto: "Jacob Rakow", telefono: "935329993", horario: "10AM‚Äì6PM", categoria: "Compras", link: "-", imagen: "-" },
  { id: 52, empresa: "PRECISUR", direccion: "Av. Morales Duares 1717", detalleDireccion: "Av. Morales Duares 1717, Cercado Lima (Altura Puente Due√±as)", distrito: "Centro Cercado Lima", contacto: "-", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
  { id: 53, empresa: "CORPORACION EMACIN S.A.C.", direccion: "Av. Ram√≥n C√°rcamo 540‚Äì542", detalleDireccion: "Av. Ram√≥n C√°rcamo 540‚Äì542, Lima (Alt. cdra. 6‚Äì7 Av. Colonial / Av. Argentina)", distrito: "Centro Lima", contacto: "Alejandro Tam", telefono: "992105254", horario: "L-V 8:30AM‚Äì5PM / S 8:30AM‚Äì1:30PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 54, empresa: "CAJUSOL", direccion: "Pasj 1 Principal, Tienda Y1-4, La Bellota", detalleDireccion: "Pasaje 1 Principal, Tienda Y1-4, CC La Bellota, Av. Dansey 520, Malvinas, Lima", distrito: "Centro Lima", contacto: "Jan", telefono: "921819283", horario: "L-V 9AM‚Äì6PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/CajusolCompras.jpg?raw=true" },
{ id: 55, empresa: "FIORELLA REPRESENTACIONES S.A.", direccion: "C. Omicron 215", detalleDireccion: "C. Omicron 215, Callao 07006", distrito: "Oeste Callao", contacto: "Bety", telefono: "946126140", horario: "L-V 9AM‚Äì6PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/Fiorella%20Representaciones.jpg?raw=true" },
{ id: 56, empresa: "GUILLERMO ROMERO", direccion: "Av. Horacio Urteaga 1156, Oficina 201", detalleDireccion: "Av. Horacio Urteaga 1156, Oficina 201, Jes√∫s Mar√≠a", distrito: "Centro Jes√∫s Mar√≠a", contacto: "-", telefono: "-", horario: "-", categoria: "Compras", link: "-", imagen: "-" },
{ id: 57, empresa: "GRUPO CARLITOS", direccion: "Jr. Huarochir√≠ 649‚Äì653, Malvinas", detalleDireccion: "Jr. Huarochir√≠ 649‚Äì653, Lima 15082, Malvinas", distrito: "Centro Lima", contacto: "Ricardo", telefono: "994065623", horario: "L-V 9AM‚Äì6PM / S 9AM‚Äì1PM (corrido)", categoria: "Compras", link: "-", imagen: "-" },
{ id: 58, empresa: "OBRAS FERRETERO", direccion: "-", detalleDireccion: "Lima", distrito: "Centro Lima", contacto: "-", telefono: "958107975", horario: "L-V 9AM‚Äì6PM / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "-" },

{ id: 59, empresa: "SONEPAR", direccion: "Jr. Yungay 1870", detalleDireccion: "Jr. Yungay 1870, Lima 15081", distrito: "Centro Lima", contacto: "Julio Cortez", telefono: "994019384", horario: "L-V 9AM‚Äì6:30PM (corr.) / S 9AM‚Äì1PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/EnSoneparCompras.jpg?raw=true" },
{ id: 60, empresa: "OHMI IMPORT S.A.", direccion: "Jr. Cusco 829", detalleDireccion: "Jr. Cusco 829, Lima 15001, Centro", distrito: "Centro Lima", contacto: "Ra√∫l", telefono: "977241586", horario: "L-V 8AM‚Äì1PM / 2PM‚Äì5PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 61, empresa: "GRUPO CARLITOS SOCIEDAD ANONIM", direccion: "Jr. Huarochir√≠ 649-653", detalleDireccion: "Jr. Huarochir√≠ 649-653, Lima 15082, Malvinas", distrito: "Centro Lima", contacto: "Ricardo", telefono: "994065623", horario: "L-V 9AM‚Äì6PM / S 9AM‚Äì1PM (corr.)", categoria: "Compras", link: "-", imagen: "-" },
{ id: 62, empresa: "DISTRIBUCIONES CLEER", direccion: "Av. Argentina con Colonial", detalleDireccion: "Av. Argentina con Colonial, Lima", distrito: "Centro Lima", contacto: "-", telefono: "947318205", horario: "8AM-1PM / 2PM-5PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 63, empresa: "P & L IMPORTACIONES INDUSTRIAL", direccion: "Jr. Huancavelica 1196, Espaldas del C.C. Unicentro", detalleDireccion: "Jr. Huancavelica 1196, Espaldas del C.C. Unicentro, Cercado de Lima", distrito: "Centro Cercado Lima", contacto: "David", telefono: "905436251", horario: "9AM-5:30PM (Refrig 1-2PM)", categoria: "Compras", link: "-", imagen: "-" },
{ id: 64, empresa: "TERRA PLASTIC SOCIEDAD ANONIMA", direccion: "Jr. Santa Rosa 1318, Barrios Altos", detalleDireccion: "Jr. Santa Rosa 1318, Barrios Altos, Lima", distrito: "Centro Lima", contacto: "Jeny", telefono: "994482151", horario: "9AM-7PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/En%20terraplastic%20sociedad%20anonimaCompras.jpg?raw=true" },
{ id: 65, empresa: "PLAN ENTERPRISE S.A.", direccion: "C. Jos√© D√≠az 426 (por Estadio Nacional)", detalleDireccion: "C. Jos√© D√≠az 426 (por Estadio Nacional), Lima", distrito: "Centro Lima", contacto: "David", telefono: "947277296", horario: "8AM-5PM (Refrig 1-2PM)", categoria: "Compras", link: "-", imagen: "-" },
{ id: 66, empresa: "CORPORACION ELECTRO INDUSTRIAL", direccion: "Av. Guillermo Dansey 454, CC Nicolini Psj 5 Stand BB-9A", detalleDireccion: "Av. Guillermo Dansey 454, CC Nicolini Psj 5 Stand BB-9A, Lima", distrito: "Centro Lima", contacto: "Jimy", telefono: "950499053", horario: "L-V 8:30-6:30PM, S 8-4PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 67, empresa: "INVERSIONES JENNER", direccion: "Av. Argentina 215 Psj 11 P-15 CC Nicolini", detalleDireccion: "Av. Argentina 215 Psj 11 P-15 CC Nicolini, Lima", distrito: "Centro Lima", contacto: "Jenner", telefono: "922891229", horario: "L-V 9AM-6PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 68, empresa: "ILUMINACIONES MILENIUM S.A.C.", direccion: "Jr. Lampa 1125a", detalleDireccion: "Jr. Lampa 1125a, Lima 15001", distrito: "Centro Lima", contacto: "Diana", telefono: "946595601", horario: "L-S 9AM-7PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 69, empresa: "ACEROS INDUSTRIALES ACRIMSA", direccion: "Jr. Mariscal Luzuriaga 533", detalleDireccion: "Jr. Mariscal Luzuriaga 533, Jes√∫s Mar√≠a", distrito: "Centro Jes√∫s Mar√≠a", contacto: "Fiorella", telefono: "943491058", horario: "L-V 9AM-6PM, S 9AM-1PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 70, empresa: "GRUPO COINP S.A.C", direccion: "Jr. Alemania 2242", detalleDireccion: "Jr. Alemania 2242, Lima", distrito: "Centro Lima", contacto: "Cesar Yengle", telefono: "908916033", horario: "L-V 8:30AM-6PM (Refrig 1-2PM)", categoria: "Compras", link: "-", imagen: "-" },
{ id: 71, empresa: "MACROQUIMICOS S.A.C.", direccion: "Bartolom√© Herrera 775", detalleDireccion: "Bartolom√© Herrera 775, Lince", distrito: "Centro Lince", contacto: "Valeria Filomeno", telefono: "975492530", horario: "L-V 8AM-1PM / 2PM-5:30PM, S 9AM-1PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 72, empresa: "REFRIGERACION RENZO S.A.", direccion: "Av. √ìscar R. Benavides 279", detalleDireccion: "Av. √ìscar R. Benavides 279, Lima", distrito: "Centro Lima", contacto: "Gabriela Ortecho", telefono: "994144943", horario: "L-V 8:30AM-5:30PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 73, empresa: "FERRETERIA INDUSTRIAL JORDAN", direccion: "Jr. Ram√≥n C√°rcamo 450 Int. 164 Galer√≠a Aspeco Femein", detalleDireccion: "Jr. Ram√≥n C√°rcamo 450 Int. 164 Galer√≠a Aspeco Femein, Lima", distrito: "Centro Lima", contacto: "Sr. Blanco", telefono: "998227989", horario: "L-V 9AM-5:30PM, S 9AM-1PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 74, empresa: "PROINDUSTRIAS E & M S.A.C.", direccion: "Av. Guillermo Dansey 417, Plaza Ferretero Pasaje C SS007", detalleDireccion: "Av. Guillermo Dansey 417, Plaza Ferretero Pasaje C SS007, Lima", distrito: "Centro Lima", contacto: "Jessica", telefono: "970666778", horario: "L-V 9AM-6:20PM, S 9AM-4:40PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 75, empresa: "SISTEMAS AGRORIEGOS DEL PERU", direccion: "Av. Argentina 327 Int A-1, CC La Bellota", detalleDireccion: "Av. Argentina 327 Int A-1, CC La Bellota, Lima", distrito: "Centro Lima", contacto: "Victor", telefono: "955371021", horario: "9AM-6PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 76, empresa: "BUILDING SYSTEMS PERU S.A.C.", direccion: "Av. Faucett 1631, Urb. Jardines Viru", detalleDireccion: "Av. Faucett 1631, Urb. Jardines Viru, Bellavista, Callao", distrito: "Oeste Callao", contacto: "-", telefono: "981288456", horario: "Refrig 12-2PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 77, empresa: "J & V MULTIUTILES PUNTO COM", direccion: "Jr. Caman√° 1103, Cruce con Uruguay", detalleDireccion: "Jr. Caman√° 1103, Cruce con Uruguay, Cercado Lima", distrito: "Centro Cercado Lima", contacto: "-", telefono: "998299624", horario: "L-V 9:05AM-7:20PM, S 9:30AM-6:15PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 78, empresa: "PJ FARMA S.R.L.", direccion: "Jr. Chancay 650", detalleDireccion: "Jr. Chancay 650, Cercado de Lima", distrito: "Centro Cercado Lima", contacto: "-", telefono: "991778777", horario: "L-V 9AM-5PM, S 9AM-1PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 79, empresa: "MC SUMINISTROS", direccion: "Urb. Procion Mz. J Lt. 2 Calle 2, Bellavista", detalleDireccion: "Urb. Procion Mz. J Lt. 2 Calle 2, Bellavista, Callao", distrito: "Oeste Callao", contacto: "Jaime Aznaran", telefono: "922338085", horario: "L-V 9AM-5PM (Refrig 1-2PM)", categoria: "Compras", link: "-", imagen: "-" },
{ id: 90, empresa: "BRACSAN S.A.C.", direccion: "Jr. Paruro 1353 Int 214 2do piso", detalleDireccion: "Jr. Paruro 1353 Int 214 2do piso, Cercado Lima", distrito: "Centro Cercado Lima", contacto: "-", telefono: "950970761", horario: "L-V 9AM-6PM, S 9AM-3PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 91, empresa: "FORUSA S.A.C.", direccion: "Plaza Ferretero o Nicolini", detalleDireccion: "Plaza Ferretero o Nicolini, Lima", distrito: "Centro Lima", contacto: "Javier", telefono: "959096306", horario: "L-V 9AM-6PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 92, empresa: "AYMURAY SAFETY S.A.C.", direccion: "Colonial 419 Interior 3, Port√≥n Plomo", detalleDireccion: "Colonial 419 Interior 3, Port√≥n Plomo, Cercado de Lima", distrito: "Centro Cercado Lima", contacto: "Diego", telefono: "940786398", horario: "Hasta las 6PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 93, empresa: "PROSINFER EIRL", direccion: "C. Jos√© Celendon 1072 (Entre Due√±as y Colonial)", detalleDireccion: "C. Jos√© Celendon 1072 (Entre Due√±as y Colonial), Lima", distrito: "Centro Lima", contacto: "-", telefono: "918527378", horario: "L-V 9AM-6PM, S 9AM-1PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 94, empresa: "BENDEZU", direccion: "Av. √ìscar R. Benavides 578", detalleDireccion: "Av. √ìscar R. Benavides 578, Lima", distrito: "Centro Lima", contacto: "-", telefono: "970390185", horario: "7AM-5PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/Bendezu%20Compras.jpg?raw=true" },
{ id: 95, empresa: "Distribuidora y abastecedora max", direccion: "Av. Jos√© G√°lvez 120", detalleDireccion: "Av. Jos√© G√°lvez 120, La Victoria", distrito: "Centro La Victoria", contacto: "-", telefono: "-", horario: "Hasta 8PM", categoria: "Compras", link: "-", imagen: "https://github.com/axon67/ProyectoRutasCerrigan/blob/main/Img/Distribuidora%20y%20abastecedora%20Max%20Compras.jpg?raw=true" },
{ id: 96, empresa: "ZITROM PERU EIRL", direccion: "Cal. Valerianias A11 Int 2P, Urb. Santa Rosita", detalleDireccion: "Cal. Valerianias A11 Int 2P, Urb. Santa Rosita, Ate", distrito: "Este Ate", contacto: "-", telefono: "942068938", horario: "10:30AM-1PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 97, empresa: "VICSA SAFETY PERU S.A.C.", direccion: "Av. Santa Rosa 350, Zona Industrial", detalleDireccion: "Av. Santa Rosa 350, Zona Industrial, Ate", distrito: "Este Ate", contacto: "Kevin", telefono: "943258758", horario: "L-V 8AM-5:30PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 98, empresa: "S & H REPRESENTACIONES", direccion: "Av. Garcilaso de la Vega 203, Urb. la Colonial", detalleDireccion: "Av. Garcilaso de la Vega 203, Urb. la Colonial, Callao", distrito: "Oeste Callao", contacto: "-", telefono: "-", horario: "Hasta 5PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 99, empresa: "MULTI TOP S.A.C.", direccion: "Av. Iquitos 670", detalleDireccion: "Av. Iquitos 670, La Victoria 15033", distrito: "Centro La Victoria", contacto: "-", telefono: "987966770", horario: "L-S 8AM-6:30PM, Feriados 9AM-5PM", categoria: "Compras", link: "-", imagen: "-" },
{ id: 100, empresa: "GUANTES & GUANTES S.A.", direccion: "Jr. Mcal. Andr√©s de Sta. Cruz 325, Urb. El Pino", detalleDireccion: "Jr. Mcal. Andr√©s de Sta. Cruz 325, Urb. El Pino, San Luis", distrito: "Centro San Luis", contacto: "Rosario", telefono: "988570724", horario: "L-V 9AM-1PM / 2PM-"
}
  ];

  let datos = [...BASE_DATOS, ...(JSON.parse(localStorage.getItem(STORAGE_KEY)) || [])];
  let filtro = "";
  let editandoId = null;

  const el = id => document.getElementById(id);

  function normalizarTexto(t) {
    return (t ?? "").toString().normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();
  }

  function coincideRegistro(reg, needle) {
    if (!needle) return true;
    const n = normalizarTexto(needle);
    return [reg.id, reg.empresa, reg.direccion, reg.detalleDireccion, reg.distrito, reg.telefono, reg.categoria, reg.horario]
      .map(v => normalizarTexto(v))
      .some(v => v.includes(n));
  }

  // Para texto plano (retorna HTML seguro con <span>)
  function resaltarCoincidencias(texto, needle) {
    if (!needle) return String(texto);
    const t = String(texto);
    const n = normalizarTexto(needle);
    const base = normalizarTexto(t);
    let res = "", i = 0;
    while (i < t.length) {
      if (base.slice(i).startsWith(n)) {
        res += `<span class="highlight">${t.slice(i, i + needle.length)}</span>`;
        i += needle.length;
      } else { res += t[i]; i++; }
    }
    return res;
  }

  // Para enlaces/nodos: construye nodos sin romper atributos ni eventos
  function resaltarCoincidenciasNodo(elemento, texto, needle) {
    elemento.innerHTML = "";
    if (!needle) { elemento.textContent = texto; return; }
    const base = normalizarTexto(texto);
    const n = normalizarTexto(needle);
    let i = 0;
    while (i < texto.length) {
      if (base.slice(i).startsWith(n)) {
        const span = document.createElement("span");
        span.className = "highlight";
        span.textContent = texto.slice(i, i + needle.length);
        elemento.appendChild(span);
        i += needle.length;
      } else {
        elemento.appendChild(document.createTextNode(texto[i]));
        i++;
      }
    }
  }

  function guardarDatos() {
    const extras = datos.filter(d => d.id > BASE_DATOS.length);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(extras));
  }

  function render() {
    const cuerpo = el("tbody"), vacio = el("vacio"), conteo = el("conteo"), queryDisplay = el("queryDisplay");
    const filtrados = datos.filter(d => coincideRegistro(d, filtro));
    conteo.textContent = `${filtrados.length} ${filtrados.length === 1 ? "item" : "items"}`;
    queryDisplay.textContent = filtro ? `"${filtro}"` : "‚Äî";
    cuerpo.innerHTML = "";
    if (filtrados.length === 0) { vacio.style.display = "block"; return; } else { vacio.style.display = "none"; }

    const frag = document.createDocumentFragment();
    filtrados.forEach(reg => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${reg.id}</td>
        <td><a href="#" class="empresaLink" data-img="${reg.imagen}" aria-label="Empresa ${reg.empresa}"></a></td>
        <td class="td-distrito"></td>
        <td><a href="#" class="direccionLink" data-dir="${reg.detalleDireccion}" aria-label="Direcci√≥n ${reg.direccion}"></a></td>
        <td><a href="${reg.link}" target="_blank" rel="noopener noreferrer">Ver en Maps</a></td>
        <td class="td-categoria"></td>
        <td class="td-horario"></td>
        <td class="td-telefono"></td>
        <td>
          <button class="btn-secondary btnEditar" data-id="${reg.id}">‚úèÔ∏è</button>
          <button class="btn btnEliminar" data-id="${reg.id}">üóëÔ∏è</button>
        </td>
      `;

      // Resaltar en nodos <a> (sin romper atributos)
      const linkEmpresa = tr.querySelector(".empresaLink");
      resaltarCoincidenciasNodo(linkEmpresa, reg.empresa, filtro);

      const linkDireccion = tr.querySelector(".direccionLink");
      resaltarCoincidenciasNodo(linkDireccion, reg.direccion, filtro);

      // Resaltar en celdas de texto (se usa innerHTML intencionadamente para spans)
      tr.querySelector(".td-distrito").innerHTML = resaltarCoincidencias(reg.distrito, filtro);
      tr.querySelector(".td-categoria").innerHTML = resaltarCoincidencias(reg.categoria, filtro);
      tr.querySelector(".td-horario").innerHTML = resaltarCoincidencias(reg.horario ?? "‚Äî", filtro);
      tr.querySelector(".td-telefono").innerHTML = resaltarCoincidencias(reg.telefono, filtro);

      frag.appendChild(tr);
    });
    cuerpo.appendChild(frag);
  }

  // Eventos b√°sicos UI
  el("buscador").addEventListener("input", e => { filtro = e.target.value.trim(); render(); });
  el("btnLimpiar").addEventListener("click", () => { filtro = ""; el("buscador").value = ""; render(); el("buscador").focus(); });

  el("btnToggleForm").addEventListener("click", () => {
    const formCard = el("formularioCard");
    formCard.style.display = formCard.style.display === "none" ? "block" : "none";
  });

  // A√±adir / Guardar
  el("btnAgregar").addEventListener("click", () => {
    const empresa = el("nuevoEmpresa").value.trim();
    const direccion = el("nuevaDireccion").value.trim();
    const detalleDireccion = el("nuevoDetalleDireccion").value.trim();
    const distrito = el("nuevoDistrito").value.trim();
    const telefono = el("nuevoTelefono").value.trim();
    const categoria = el("nuevaCategoria").value.trim();
    const link = el("nuevoLink").value.trim();
    const imagen = el("nuevaImagen").value.trim();
    const horario = el("nuevoHorario").value.trim();

    if (!empresa || !direccion || !detalleDireccion || !distrito || !telefono || !categoria || !link || !imagen || !horario) {
      alert("Completa todos los campos.");
      return;
    }

    if (editandoId) {
      const idx = datos.findIndex(d => d.id === editandoId);
      if (idx >= 0) {
        datos[idx] = { id: editandoId, empresa, direccion, detalleDireccion, distrito, telefono, categoria, link, imagen, horario };
      }
      editandoId = null;
    } else {
      const nextId = (datos.at(-1)?.id ?? 0) + 1;
      datos.push({ id: nextId, empresa, direccion, detalleDireccion, distrito, telefono, categoria, link, imagen, horario });
    }

    guardarDatos();

    // limpiar form
    ["nuevoEmpresa","nuevaDireccion","nuevoDetalleDireccion","nuevoDistrito","nuevoTelefono","nuevaCategoria","nuevoLink","nuevaImagen","nuevoHorario"].forEach(id => el(id).value = "");
    el("formularioCard").style.display = "none";
    render();
  });

  // Borrar todos (solo extras)
  el("btnBorrar").addEventListener("click", () => {
    if (!confirm("¬øSeguro que quieres borrar todos los registros agregados?")) return;
    datos = [...BASE_DATOS];
    localStorage.removeItem(STORAGE_KEY);
    render();
  });

  // Delegaci√≥n de clics para acciones de fila y enlaces
  document.addEventListener("click", e => {
    // Editar
    const btnE = e.target.closest(".btnEditar");
    if (btnE) {
      const id = Number(btnE.dataset.id);
      const registro = datos.find(d => d.id === id);
      if (!registro) return;
      // llenar form
      el("nuevoEmpresa").value = registro.empresa;
      el("nuevaDireccion").value = registro.direccion;
      el("nuevoDetalleDireccion").value = registro.detalleDireccion;
      el("nuevoDistrito").value = registro.distrito;
      el("nuevoTelefono").value = registro.telefono;
      el("nuevaCategoria").value = registro.categoria;
      el("nuevoLink").value = registro.link;
      el("nuevaImagen").value = registro.imagen;
      el("nuevoHorario").value = registro.horario ?? "";
      editandoId = id;
      el("formularioCard").style.display = "block";
      el("nuevoEmpresa").focus();
      return;
    }

    // Eliminar
    const btnDel = e.target.closest(".btnEliminar");
    if (btnDel) {
      const id = Number(btnDel.dataset.id);
      if (id <= BASE_DATOS.length) {
        alert("No puedes eliminar un dato base.");
        return;
      }
      if (!confirm("¬øSeguro que quieres eliminar este registro?")) return;
      datos = datos.filter(d => d.id !== id);
      guardarDatos();
      render();
      return;
    }

    // Modal imagen (empresa)
    const linkEmpresa = e.target.closest(".empresaLink");
    if (linkEmpresa) {
      e.preventDefault();
      const img = linkEmpresa.dataset.img;
      el("modalImg").src = img || "";
      el("modal").style.display = "flex";
      return;
    }

    // Modal direcci√≥n
    const linkDireccion = e.target.closest(".direccionLink");
    if (linkDireccion) {
      e.preventDefault();
      const detalle = linkDireccion.dataset.dir;
      el("detalleDireccion").textContent = detalle || "";
      el("modalDireccion").style.display = "flex";
      return;
    }
  });

  // Cerrar modales
  el("cerrarModal").addEventListener("click", () => { el("modal").style.display = "none"; });
  el("cerrarModalDireccion").addEventListener("click", () => { el("modalDireccion").style.display = "none"; });

  // Cerrar modal al hacer click fuera del contenido (opcional y √∫til)
  window.addEventListener("click", (e) => {
    if (e.target === el("modal")) el("modal").style.display = "none";
    if (e.target === el("modalDireccion")) el("modalDireccion").style.display = "none";
  });

  // inicializar
  render();
  </script>
</body>
</html>
